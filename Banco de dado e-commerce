create database projeto_ecommerce;
use projeto_ecommerce;
-- CLIENTE: Pessoa Física ou Jurídica (exclusivos)
CREATE TABLE client (
        idClient INT AUTO_INCREMENT PRIMARY KEY,
        Fname VARCHAR(50),
        Lname VARCHAR(50),
         CPF CHAR(11) UNIQUE,
         CNPJ CHAR(14) UNIQUE,
         Address VARCHAR(255),
         CHECK (
        (CPF IS NOT NULL AND CNPJ IS NULL) OR
        (CPF IS NULL AND CNPJ IS NOT NULL)
    )
);

-- PRODUTO
CREATE TABLE product (
         idProduct INT AUTO_INCREMENT PRIMARY KEY,
         Pname VARCHAR(50) NOT NULL,
         category ENUM('Eletronico','Vestimenta','Brinquedos','Alimentos','Móveis') NOT NULL,
         avaliação FLOAT DEFAULT 0,
         size VARCHAR(10)
);

-- FORNECEDOR
CREATE TABLE supplier (
                idSupplier INT AUTO_INCREMENT PRIMARY KEY,
                SocialName VARCHAR(255) NOT NULL,
                CNPJ CHAR(14) UNIQUE NOT NULL,
                contact CHAR(15) NOT NULL
);

-- VENDEDOR
CREATE TABLE seller (
            idSeller INT AUTO_INCREMENT PRIMARY KEY,
             SocialName VARCHAR(255) NOT NULL,
            CNPJ CHAR(14) UNIQUE,
            CPF CHAR(11) UNIQUE,
            location VARCHAR(255),
            contact CHAR(11)
);

-- RELAÇÃO PRODUTO-VENDEDOR
CREATE TABLE productSeller (
        idSeller INT,
        idProduct INT,
        prodQuantity INT DEFAULT 1,
        PRIMARY KEY (idSeller, idProduct),
         FOREIGN KEY (idSeller) REFERENCES seller(idSeller),
        FOREIGN KEY (idProduct) REFERENCES product(idProduct)
);

-- RELAÇÃO PRODUTO-FORNECEDOR
CREATE TABLE productSupplier (
        idSupplier INT,
        idProduct INT,
        quantity INT NOT NULL,
    PRIMARY KEY (idSupplier, idProduct),
    FOREIGN KEY (idSupplier) REFERENCES supplier(idSupplier),
    FOREIGN KEY (idProduct) REFERENCES product(idProduct)
);

-- ESTOQUE
CREATE TABLE productStorage (
    idStorage INT AUTO_INCREMENT PRIMARY KEY,
    storageLocation VARCHAR(255),
    quantity INT DEFAULT 0
);

-- RELAÇÃO PRODUTO-ESTOQUE
CREATE TABLE storageLocation (
        idProduct INT,
        idStorage INT,
		location VARCHAR(255),
    PRIMARY KEY (idProduct, idStorage),
    FOREIGN KEY (idProduct) REFERENCES product(idProduct),
    FOREIGN KEY (idStorage) REFERENCES productStorage(idStorage)
);

-- PEDIDOS
CREATE TABLE orders (
    idOrder INT AUTO_INCREMENT PRIMARY KEY,
    idClient INT,
    orderStatus ENUM('Cancelado','Confirmado','Em processamento') DEFAULT 'Em processamento',
    orderDescription VARCHAR(255),
    sendValue FLOAT DEFAULT 10,
    paymentChash BOOL DEFAULT FALSE,
    CONSTRAINT fk_orders_client FOREIGN KEY (idClient) REFERENCES client(idClient)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

-- ENTREGA
CREATE TABLE delivery (
    idDelivery INT AUTO_INCREMENT PRIMARY KEY,
    idOrder INT,
    trackingCode VARCHAR(50),
    deliveryStatus ENUM('Pendente','Enviado','Entregue') DEFAULT 'Pendente',
    FOREIGN KEY (idOrder) REFERENCES orders(idOrder)
);

-- FORMAS DE PAGAMENTO
CREATE TABLE payment (
        idPayment INT AUTO_INCREMENT PRIMARY KEY,
        idOrder INT,
        method ENUM('Cartão','Pix','Boleto','Dinheiro') NOT NULL,
        amount FLOAT NOT NULL,
    FOREIGN KEY (idOrder) REFERENCES orders(idOrder)
);

-- PRODUTOS DO PEDIDO
CREATE TABLE productOrder (
        idProduct INT,
        idOrder INT,
        quantity INT DEFAULT 1,
        status ENUM('Disponível','Sem estoque') DEFAULT 'Disponível',
        PRIMARY KEY (idProduct, idOrder),
        FOREIGN KEY (idProduct) REFERENCES product(idProduct),
        FOREIGN KEY (idOrder) REFERENCES orders(idOrder)
);
        FOREIGN KEY (idOrder) REFERENCES orders(idOrder)
);
